# Track Brief: Agent Tools (Phase C)

> Generated by Architect based on `initial-plan.md`

## What This Track Delivers
This track implements the Python tools that allow the agent to interact with the metadata and BigQuery. It creates the 6 core tools: `vector_search_tables`, `load_yaml_metadata`, `fetch_few_shot_examples`, `dry_run_sql`, `execute_sql`, and `save_validated_query`. It wires them into `nl2sql_agent.py`.

## Source Requirements (from initial-plan.md)
- **C.1 Vector Search:** `vector_search.py` implementing `vector_search_tables` and `fetch_few_shot_examples` using BigQuery SQL.
- **C.2 Metadata Loader:** `metadata_loader.py` loading YAML files from `catalog/` directory.
- **C.3 SQL Validator:** `sql_validator.py` implementing `dry_run_sql` and `execute_sql` (read-only enforcement).
- **C.4 Learning Loop:** `learning_loop.py` saving question/sql pairs to `metadata.query_memory`.
- **C.5 Wire Tools:** Update `nl2sql_agent` to register all 6 tools.

## Cross-Cutting Constraints
- **Structured Logging:** All tools must log their inputs and outputs (traceable).
- **Timeouts:** Set `timeout=30s` on `execute_sql` queries.
- **Read-Only:** `execute_sql` must reject non-SELECT queries.

## Interface Contracts
- **Owned:** `Agent Tools` (Python functions)
- **Consumed:** `BigQuery` (via `google-cloud-bigquery`), `Metadata Catalog` (YAML)

## Key Design Decisions
1.  **Search Logic:** Use `bq.query` for vector search or specialized client? -> **BigQuery SQL** (`VECTOR_SEARCH`) for simplicity.
2.  **Metadata Path:** Hardcode or relative path? -> **Relative** (via `Path(__file__)`) for portability.
3.  **Execute Limits:** Row limit? -> **1000** (as per plan).

## Test Strategy
- **Unit:** Mock `bigquery.Client` and verify tool logic.
- **Integration:** Run each tool against `dev_agent_test` (e.g., `vector_search("edge")` -> returns kpi table).
- **Manual:** Invoke tools via ADK Web UI or REPL.

## Complexity: Medium
## Estimated Phases: 3
