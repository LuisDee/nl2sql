<!-- generated by autopsy -->
# Example Queries

## Purpose
Validated question-to-SQL pairs used for few-shot retrieval. These examples are loaded into BQ query_memory table via populate_embeddings.py and used by the fetch_few_shot_examples tool to give the LLM proven SQL patterns for similar questions.

## Key Files
| File | Purpose | Key Exports |
|------|---------|-------------|
| kpi_examples.yaml | KPI performance queries: edge, PnL, slippage, delta bucket analysis | ~15 examples |
| data_examples.yaml | Raw data queries: theo/vol, market data, market depth | ~10 examples |
| routing_examples.yaml | Cross-dataset disambiguation and UNION ALL patterns | ~8 examples |

## Data Flow
YAML examples -> populate_embeddings.py -> BQ query_memory (MERGE) -> ML.GENERATE_EMBEDDING -> VECTOR_SEARCH at query time

## Dependencies
- Internal: Consumed by nl2sql_agent/catalog_loader.py (load_all_examples), scripts/populate_embeddings.py
- External: None (static YAML files)

## Patterns & Conventions
- All SQL uses `{project}` placeholder (resolved at runtime)
- Required keys: question, sql, tables_used, dataset, complexity
- Complexity levels: simple, medium, complex
- routing_signal explains WHY this table was chosen (helps LLM learn routing logic)

## Gotchas
- Examples MUST have {project} in SQL or catalog_loader validation fails
- dataset must be exactly "nl2sql_omx_kpi" or "nl2sql_omx_data" (validated)
- Examples are loaded into BQ via MERGE on question field (exact string match for dedup)

## Testing
- Tests: tests/test_yaml_catalog.py validates example YAML structure
- Run: `pytest tests/test_yaml_catalog.py -v`

## Boundaries
- **Always:** use {project} placeholder, include routing_signal for disambiguation value
- **Ask first:** removing existing examples (may affect few-shot quality)
- **Never:** add examples with hardcoded project IDs or invalid dataset names

## Recent Changes
- 2026-02-20: Initial documentation generated by autopsy
