table:
  name: mako_underlyingtrade
  dataset: "{dataset_prefix}ice_data"
  fqn: '{project}.{dataset_prefix}ice_data.mako_underlyingtrade'
  layer: data
  description: "Mako's underlying hedge trade executions. Contains trades in the underlying instrument used to delta-hedge options positions, including price, size, and hedge context. Partitioned by trade_date."
  partition_field: trade_date
  columns:
    - name: trade_date
      type: DATE
      description: Trading session date used as the partition column. Always filter on this field for efficient queries.
      category: time
      filterable: true
    - name: symbol
      type: STRING
      description: Mako symbol identifier for the traded instrument.
      category: dimension
      filterable: true
    - name: portfolio
      type: STRING
      description: Name of the Mako portfolio to which the algo belongs.
      category: dimension
      filterable: true
    - name: instrument_hash
      type: STRING
      description: Unique SHA256 hash identifier for the instrument, deterministically computed from the instrument
        defining attributes. Used as the primary join key across all data and KPI tables.
      category: identifier
      filterable: true
    - name: parent_instrument_hash
      type: STRING
      description: SHA256 hash identifier for the parent instrument.
      category: identifier
      filterable: true
    - name: parent_is_combo
      type: BOOLEAN
      description: Parent instrument is combo from the instrument definition.
      category: dimension
      filterable: true
    - name: is_parent
      type: BOOLEAN
      description: Boolean flag indicating whether the parent condition is true.
      category: dimension
      filterable: true
    - name: leg_ratio
      type: FLOAT
      description: Combo leg ratio.
      category: measure
      typical_aggregation: AVG
    - name: no_legs
      type: INTEGER
      description: Number of legs in a combo/spread instrument.
      category: measure
      typical_aggregation: AVG
    - name: leg_index
      type: INTEGER
      description: Combo leg index.
      category: measure
      typical_aggregation: AVG
    - name: parent_combo_type_name
      type: STRING
      description: Human-readable name for the parent combo type enum value.
      category: dimension
      filterable: true
    - name: inst_type_name
      type: STRING
      description: Human-readable instrument type name (e.g. option, future, stock), enriched from the instruments
        reference table.
      category: dimension
      filterable: true
    - name: underlying_inst_type_name
      type: STRING
      description: Human-readable name for the underlying inst type enum value.
      category: dimension
      filterable: true
    - name: combo_type_name
      type: STRING
      description: Human-readable name for the combo type enum value.
      category: dimension
      filterable: true
    - name: expiry_timestamp
      type: TIMESTAMP
      description: Expiry timestamp for the instrument, enriched from the instruments reference table.
      category: time
    - name: term
      type: STRING
      description: Expiry term/maturity label for the instrument, enriched from the instruments reference table.
      category: dimension
      filterable: true
    - name: currency
      type: INTEGER
      description: Enum appears as an int in composition.
      category: dimension
      filterable: true
    - name: trader_id
      type: STRING
      description: Identifier of the trader responsible for this trade.
      category: identifier
      filterable: true
    - name: mako_id
      type: STRING
      description: Mako-internal unique identifier for this trade or order.
      category: identifier
      filterable: true
    - name: algorithm
      type: STRING
      description: Name of the Mako algorithm that generated this trade or event.
      category: dimension
      filterable: true
    - name: channel
      type: STRING
      description: Data channel or feed identifier for this event.
      category: dimension
      filterable: true
    - name: inventory
      type: STRING
      description: Inventory account associated with this trade or position.
      category: dimension
      filterable: true
    - name: account
      type: STRING
      description: Account identifier for this trade.
      category: dimension
      filterable: true
    - name: transaction_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the transaction occurred.
      category: time
    - name: transaction_timestamp_ns
      type: INTEGER
      description: Nanosecond-precision component of the transaction timestamp. Combine with transaction_timestamp for
        full nanosecond-resolution timing.
      category: time
    - name: exchange_timestamp
      type: TIMESTAMP
      description: Exchange-provided nano-second timestamp of the event.
      category: time
    - name: exchange_timestamp_ns
      type: INTEGER
      description: Nanosecond-precision component of exchange timestamp. Exchange-provided nano-second timestamp of the
        event.
      category: time
    - name: exchange_date
      type: DATE
      description: Date as reported by the exchange for this event.
      category: time
      filterable: true
    - name: exchange_transaction_id
      type: STRING
      description: Exchange-assigned transaction identifier for this event.
      category: identifier
      filterable: true
    - name: exchange_order_id
      type: STRING
      description: Exchange-assigned order identifier.
      category: identifier
      filterable: true
    - name: agg_pos_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the agg pos occurred.
      category: time
    - name: agg_pos_timestamp_ns
      type: INTEGER
      description: Nanosecond-precision component of the agg pos timestamp. Combine with agg_pos_timestamp for full
        nanosecond-resolution timing.
      category: time
    - name: agg_pos_date
      type: DATE
      description: Aggregated position date for end-of-day processing.
      category: time
    - name: revision
      type: INTEGER
      description: Revision number tracking modifications to this record.
      category: identifier
      filterable: true
    - name: revision_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the revision occurred.
      category: time
    - name: revision_timestamp_ns
      type: INTEGER
      description: Nanosecond-precision component of the revision timestamp. Combine with revision_timestamp for full
        nanosecond-resolution timing.
      category: time
    - name: traded_size
      type: INTEGER
      description: Number of lots traded in this transaction.
      category: measure
      typical_aggregation: SUM
    - name: price
      type: FLOAT
      description: Price of the trade or order.
      category: measure
      typical_aggregation: AVG
    - name: size
      type: INTEGER
      description: Number of lots or contracts in the trade or order.
      category: measure
      typical_aggregation: AVG
    - name: tv
      type: FLOAT
      description: Theoretical value the VT saw at time of swing/market trade.
      category: measure
      typical_aggregation: AVG
    - name: counterparty
      type: STRING
      description: Counterparty identifier for this trade.
      category: dimension
      filterable: true
    - name: revisor
      type: STRING
      description: Identifier of the user or process that last revised this record.
      category: dimension
      filterable: true
    - name: transaction_id
      type: INTEGER
      description: Mako-internal transaction identifier for this event.
      category: identifier
      filterable: true
    - name: order_id
      type: INTEGER
      description: Mako-internal order identifier linking fills to the parent order.
      category: identifier
      filterable: true
    - name: position_type
      type: INTEGER
      description: Numeric code classifying the position event type (e.g. trade, adjustment, exercise).
      category: dimension
      filterable: true
    - name: position_id
      type: INTEGER
      description: Identifier for the position this event belongs to within the portfolio.
      category: identifier
      filterable: true
    - name: curve_id
      type: INTEGER
      description: Identifier for the volatility/pricing curve used in theoretical calculations.
      category: identifier
      filterable: true
    - name: carry_id
      type: INTEGER
      description: Identifier for the carry/interest rate curve used in theoretical calculations.
      category: identifier
      filterable: true
    - name: trade_id
      type: INTEGER
      description: Exchange-assigned trade identifier.
      category: identifier
      filterable: true
    - name: text
      type: STRING
      description: Free-text field containing additional descriptive information about this event.
      category: dimension
      filterable: true
    - name: strike
      type: FLOAT
      description: Strike price for options, enriched from the instruments reference table. NULL for non-option
        instruments.
      category: measure
      typical_aggregation: AVG
    - name: option_type
      type: INTEGER
      description: Option type code (C=Call, P=Put), enriched from the instruments reference table. NULL for non-option
        instruments.
      category: dimension
      filterable: true
    - name: option_type_name
      type: STRING
      description: Human-readable option type name (Call/Put), enriched from the instruments reference table.
      category: dimension
      filterable: true
    - name: contract_size
      type: FLOAT
      description: Number of units per contract lot. Streamed from TradableInstrument.contractSize proto field.
      category: measure
      typical_aggregation: AVG
    - name: underlying_exe_exch
      type: INTEGER
      description: Exchange where the underlying trades.
      category: measure
      typical_aggregation: AVG
    - name: parent_feed_code
      type: STRING
      description: Parent instrument feed code from the instrument definition.
      category: dimension
      filterable: true
    - name: total_traded_size
      type: FLOAT
      description: Cumulative number of lots traded across all fills for this order.
      category: measure
      typical_aggregation: SUM
    - name: liquid
      type: INTEGER
      description: Liquidity indicator or classification for the instrument.
      category: measure
      typical_aggregation: AVG
