# Track Brief: Foundation (Phase A)

> Generated by Architect based on `initial-plan.md`

## What This Track Delivers
This track establishes the foundational infrastructure for the NL2SQL agent. It sets up the Python repository structure, configures the development environment (including `pyproject.toml` and `.env`), creates the BigQuery development dataset (`dev_agent_test`) with sample data, extracts initial schemas, and implements the basic "Root Agent -> Sub-Agent" delegation skeleton using Google ADK.

## Source Requirements (from initial-plan.md)
- **A.1 Repo Scaffolding:** `mkdir -p` structure, `pyproject.toml` with `google-adk`, `google-cloud-bigquery`, `pyyaml`.
- **A.2 Dev Dataset:** SQL scripts to create `dev_agent_test` and populate `theodata`, `kpi_*`, `quoter_quotertrade` from production (filtered by symbol/date).
- **A.3 Schema Extraction:** Python script to dump BigQuery schemas to JSON and generate YAML templates.
- **A.4 Agent Skeleton:** Implement `mako_assistant` (Root) and `nl2sql_agent` (Sub) classes.
- **A.5 Delegation Test:** Verify `transfer_to_agent` works in ADK web UI.

## Cross-Cutting Constraints
- **Structured Logging:** All agents must log initialization and delegation events in JSON format.
- **Configuration:** Use `pydantic-settings` to load `GCP_PROJECT`, `BQ_LOCATION`, etc. from `.env`.
- **Testing:** `pytest` setup for unit tests of the agent classes.

## Interface Contracts
- **Owned:** `Agent(mako_assistant)` (Entry point)
- **Consumed:** `BigQuery` (via `google-cloud-bigquery`), `Vertex AI` (via ADK)

## Key Design Decisions
1.  **Repo Structure:** Follow the nested `agent/nl2sql/` structure or flat? -> **Nested** (as per plan) to allow future sub-agents (Compliance, etc.).
2.  **Dev Data Strategy:** Copy full tables or thin slices? -> **Thin slices** (1 symbol, 30 days) to keep dev fast and cheap.
3.  **Schema Source:** JSON or YAML? -> **JSON** as source of truth for types, **YAML** for human descriptions (Layer 1).

## Test Strategy
- **Unit:** Test `RootAgent` initialization and `sub_agents` list.
- **Integration:** Run `extract_schemas.py` and verify JSON output matches BigQuery.
- **Manual:** ADK Web UI test for delegation ("Hello" -> Root, "Show trades" -> Sub).

## Complexity: Medium
## Estimated Phases: 3
