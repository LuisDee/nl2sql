table:
  name: brokertrade_data
  dataset: "{dataset_prefix}brazil_data"
  fqn: '{project}.{dataset_prefix}brazil_data.brokertrade_data'
  layer: data
  description: "Broker trade data records containing off-floor/OTC trade execution details. Similar to brokertrade but in a separate data format with broker, counterparty, and fill information. Partitioned by trade_date."
  partition_field: trade_date
  columns:
    - name: kafka_message_timestamp
      type: TIMESTAMP
      description: Kafka ingestion timestamp recording when this message was produced to the Kafka topic. Used
        internally for data pipeline monitoring and replay.
      category: time
    - name: record_written_timestamp
      type: TIMESTAMP
      description: Timestamp when this record was written to the data warehouse by the data pipeline. Used for tracking
        data freshness and pipeline latency.
      category: time
    - name: kafka_partition
      type: INTEGER
      description: Kafka partition number from which this record was consumed. Used internally for data pipeline
        tracking and replay.
      category: identifier
      filterable: true
    - name: kafka_offset
      type: INTEGER
      description: Kafka offset of the record within its partition. Used for exactly-once processing guarantees and data
        pipeline replay.
      category: identifier
      filterable: true
    - name: partition_timestamp_local
      type: TIMESTAMP
      description: Local-timezone timestamp of the data partition. Used for partition-level data management in the
        pipeline.
      category: time
    - name: partition_number
      type: INTEGER
      description: Numeric partition identifier within the data pipeline. Used for data distribution and parallel
        processing.
      category: measure
      typical_aggregation: AVG
    - name: uuid
      type: STRING
      description: Universally unique identifier for this record.
      category: dimension
      filterable: true
    - name: portfolio
      type: STRING
      description: Name of the Mako portfolio to which the algo belongs.
      category: dimension
      filterable: true
    - name: instrument_hash
      type: STRING
      description: Unique SHA256 hash identifier for the instrument, deterministically computed from the instrument
        defining attributes. Used as the primary join key across all data and KPI tables.
      category: identifier
      filterable: true
    - name: parent_instrument_hash
      type: STRING
      description: SHA256 hash identifier for the parent instrument.
      category: identifier
      filterable: true
    - name: entry_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the entry occurred.
      category: time
    - name: last_edit_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the last edit occurred.
      category: time
    - name: trade_timestamp
      type: TIMESTAMP
      description: Timestamp recording when the trade occurred.
      category: time
    - name: revision
      type: INTEGER
      description: Revision number tracking modifications to this record.
      category: identifier
      filterable: true
    - name: counterparty
      type: STRING
      description: Counterparty identifier for this trade.
      category: dimension
      filterable: true
    - name: user
      type: STRING
      description: User identifier associated with this trade or action.
      category: dimension
      filterable: true
    - name: inventory
      type: STRING
      description: Inventory account associated with this trade or position.
      category: dimension
      filterable: true
    - name: contract_name
      type: STRING
      description: Human-readable name for the contract enum value.
      category: dimension
      filterable: true
    - name: source
      type: STRING
      description: Source system or feed that originated this record.
      category: dimension
      filterable: true
    - name: broker
      type: STRING
      description: Broker identifier associated with this trade.
      category: dimension
      filterable: true
    - name: datasource_pid
      type: INTEGER
      description: Data source pid identifier from the data pipeline infrastructure.
      category: measure
      typical_aggregation: AVG
    - name: datasource_hostname
      type: STRING
      description: Data source hostname identifier from the data pipeline infrastructure.
      category: dimension
      filterable: true
    - name: streamsource_stream_id
      type: INTEGER
      description: Stream source stream id identifier from the data streaming infrastructure.
      category: identifier
      filterable: true
    - name: streamsource_event_id
      type: INTEGER
      description: Stream source event id identifier from the data streaming infrastructure.
      category: identifier
      filterable: true
    - name: streamsource_message_id
      type: INTEGER
      description: Stream source message id identifier from the data streaming infrastructure.
      category: identifier
      filterable: true
    - name: month
      type: INTEGER
      description: Month of a year. Must be from 1 to 12.
      category: measure
      typical_aggregation: AVG
    - name: day
      type: INTEGER
      description: Day of a month. Must be from 1 to 31.
      category: measure
      typical_aggregation: AVG
    - name: year
      type: INTEGER
      description: Year of the date. Must be from 1 to 9999, or 0 for no year.
      category: measure
      typical_aggregation: AVG
    - name: trade_date
      type: DATE
      description: Trading session date used as the partition column. Always filter on this field for efficient queries.
      category: time
      filterable: true
    - name: tte
      type: FLOAT
      description: Time to expiry in years for the instrument.
      category: measure
      typical_aggregation: AVG
    - name: ref_price
      type: FLOAT
      description: Reference price from the last vol curve update (theoServer callback).
      category: measure
      typical_aggregation: AVG
    - name: carry_id
      type: INTEGER
      description: Identifier for the carry/interest rate curve used in theoretical calculations.
      category: identifier
      filterable: true
    - name: curve_id
      type: INTEGER
      description: Identifier for the volatility/pricing curve used in theoretical calculations.
      category: identifier
      filterable: true
    - name: vol
      type: FLOAT
      description: Implied volatility of the instrument at the time of this event.
      category: measure
      typical_aggregation: AVG
    - name: when_timestamp
      type: TIMESTAMP
      description: Theoreticals::when (resolution of seconds).
      category: time
    - name: vega
      type: FLOAT
      description: Option vega (sensitivity of option price to changes in implied volatility).
      category: measure
      typical_aggregation: AVG
    - name: tv
      type: FLOAT
      description: Theoretical value the VT saw at time of swing/market trade.
      category: measure
      typical_aggregation: AVG
    - name: under
      type: FLOAT
      description: Price of the underlying instrument at the time of this event.
      category: measure
      typical_aggregation: AVG
    - name: gamma
      type: FLOAT
      description: Option gamma (rate of change of delta with respect to underlying price).
      category: measure
      typical_aggregation: AVG
    - name: roll
      type: FLOAT
      description: Roll value at time of swing/trade.
      category: measure
      typical_aggregation: AVG
    - name: delta
      type: FLOAT
      description: Option delta (rate of change of option price with respect to underlying price).
      category: measure
      typical_aggregation: AVG
    - name: price
      type: FLOAT
      description: Price of the trade or order.
      category: measure
      typical_aggregation: AVG
    - name: is_mako_or_market
      type: STRING
      description: Flag indicating whether this trade leg is from Mako or from the market.
      category: dimension
      filterable: true
    - name: executable_exchange
      type: INTEGER
      description: Exchange on which this instrument is executable.
      category: measure
      typical_aggregation: AVG
    - name: strike
      type: FLOAT
      description: Strike price for options, enriched from the instruments reference table. NULL for non-option
        instruments.
      category: measure
      typical_aggregation: AVG
    - name: option_type_name
      type: STRING
      description: Human-readable option type name (Call/Put), enriched from the instruments reference table.
      category: dimension
      filterable: true
    - name: parent_is_combo
      type: BOOLEAN
      description: Parent instrument is combo from the instrument definition.
      category: dimension
      filterable: true
    - name: leg_ratio
      type: FLOAT
      description: Combo leg ratio.
      category: measure
      typical_aggregation: AVG
    - name: leg_index
      type: INTEGER
      description: Combo leg index.
      category: measure
      typical_aggregation: AVG
    - name: underlying_inst_type_name
      type: STRING
      description: Human-readable name for the underlying inst type enum value.
      category: dimension
      filterable: true
    - name: symbol
      type: STRING
      description: Mako symbol identifier for the traded instrument.
      category: dimension
      filterable: true
    - name: combo_type_name
      type: STRING
      description: Human-readable name for the combo type enum value.
      category: dimension
      filterable: true
    - name: underlying_symbol
      type: STRING
      description: Underlying instrument symbol, mirrored from the parent instrument definition.
      category: dimension
      filterable: true
    - name: market_or_mako_trade
      type: STRING
      description: Indicator distinguishing whether this is a market trade or a Mako trade.
      category: dimension
      filterable: true
    - name: count_calendar
      type: INTEGER
      description: Count calendar (numeric).
      category: measure
      typical_aggregation: AVG
    - name: is_parent
      type: BOOLEAN
      description: Boolean flag indicating whether the parent condition is true.
      category: dimension
      filterable: true
    - name: is_ref_component
      type: INTEGER
      description: Flag indicating whether the ref component condition is true. Stored as integer (0=false, 1=true).
      category: measure
      typical_aggregation: AVG
    - name: underlying_exe_exch
      type: INTEGER
      description: Exchange where the underlying trades.
      category: measure
      typical_aggregation: AVG
    - name: liquid
      type: INTEGER
      description: Liquidity indicator or classification for the instrument.
      category: measure
      typical_aggregation: AVG
    - name: company
      type: STRING
      description: Company or firm identifier for this trade.
      category: dimension
      filterable: true
    - name: brokerage_rate
      type: FLOAT
      description: Rate value for brokerage.
      category: measure
      typical_aggregation: AVG
    - name: fee_method
      type: STRING
      description: Fee method (text).
      category: dimension
      filterable: true
    - name: parent_feed_code
      type: STRING
      description: Parent instrument feed code from the instrument definition.
      category: dimension
      filterable: true
    - name: currency
      type: INTEGER
      description: Enum appears as an int in composition.
      category: dimension
      filterable: true
    - name: contract_size
      type: FLOAT
      description: Number of units per contract lot. Streamed from TradableInstrument.contractSize proto field.
      category: measure
      typical_aggregation: AVG
    - name: no_legs
      type: INTEGER
      description: Number of legs in a combo/spread instrument.
      category: measure
      typical_aggregation: AVG
    - name: inst_type_name
      type: STRING
      description: Human-readable instrument type name (e.g. option, future, stock), enriched from the instruments
        reference table.
      category: dimension
      filterable: true
    - name: underlying_instrument_hash
      type: STRING
      description: SHA256 hash identifier for the underlying instrument.
      category: identifier
      filterable: true
    - name: parent_combo_type_name
      type: STRING
      description: Human-readable name for the parent combo type enum value.
      category: dimension
      filterable: true
    - name: term
      type: STRING
      description: Expiry term/maturity label for the instrument, enriched from the instruments reference table.
      category: dimension
      filterable: true
    - name: expiry_timestamp
      type: TIMESTAMP
      description: Expiry timestamp for the instrument, enriched from the instruments reference table.
      category: time
    - name: total_traded_size
      type: FLOAT
      description: Cumulative number of lots traded across all fills for this order.
      category: measure
      typical_aggregation: SUM
    - name: size
      type: INTEGER
      description: Number of lots or contracts in the trade or order.
      category: measure
      typical_aggregation: AVG
    - name: ref_term
      type: STRING
      description: Reference term from the last vol curve update (theoServer callback).
      category: dimension
      filterable: true
    - name: ref_inst_type_name
      type: STRING
      description: Human-readable name for the ref inst type enum value.
      category: dimension
      filterable: true
